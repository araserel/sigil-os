---
name: handoff-back
description: Posts implementation summary back to the originating external ticket (Jira, etc.) after a feature completes. Adds a comment with results, transitions status, and links artifacts.
version: 1.0.0
category: workflow
chainable: false
invokes: [jira]
invoked_by: [orchestrator]
tools: Read, ToolSearch
model: haiku
---

# Skill: Handoff Back

## Purpose

Close the loop on ticket-driven workflows. After code review passes for a feature that originated from an external ticket, this skill posts a summary back to the ticket, transitions its status, and links any relevant artifacts.

## When to Invoke

- After code review passes in the orchestrator (Step 4b, "After All Tasks")
- Only when `ticket_key` is present in the chain context (indicating the feature originated from a ticket)
- Triggered by the orchestrator, not manually

## Inputs

**Required (from chain context):**
- `ticket_key`: string — The originating ticket key (e.g., `PROJ-123`)
- `adapter`: string — The adapter used to load the ticket (e.g., `jira`)

**Auto-loaded:**
- `spec_path`: string — Path to the feature's spec directory
- `review_status`: string — Code review result (`APPROVED`, `CHANGES REQUESTED`)
- `tasks_completed`: number — Count of completed tasks
- `files_changed`: array — List of files changed during implementation

## Process

### Step 1: Check Ticket Context

1. Verify `ticket_key` exists in chain context
2. If missing → return silently (feature was not ticket-driven)
3. Verify the adapter is still available (MCP tools accessible)
4. If adapter unavailable:
   ```
   Could not update ticket {ticket_key} — {adapter} MCP
   is not available. The summary is saved locally in your
   spec directory instead.
   ```
   → Write summary to `{spec_path}/ticket-summary.md` as fallback
   → Return (non-blocking)

### Step 2: Assemble Summary

Build a concise implementation summary from the chain context:

```markdown
## Sigil Implementation Summary

**Status:** {review_status}
**Tasks Completed:** {tasks_completed}
**Files Changed:** {files_changed count}

### What Was Built
{Brief summary from spec.md — first 3 requirements}

### Key Files
{Top 5 files changed, grouped by type}

### Quality Checks
- QA Validation: Passed
- Code Review: {review_status}
- {Security review status if applicable}

### Notes
{Any overrides applied, waivers logged, or escalations during implementation}

---
*Generated by Sigil OS*
```

### Step 3: Invoke Adapter Write Protocols

Based on the adapter type, invoke the appropriate write protocols:

1. **Post Summary:** Invoke the adapter's Post Summary protocol to add a comment to the ticket with the implementation summary.

2. **Transition Status:** If the review status is `APPROVED`, invoke the adapter's Transition Status protocol to move the ticket to "Done" (or equivalent, per status mapping in config).

3. **Link Artifact:** If the spec directory contains a technical review package, invoke the adapter's Link Artifact protocol to add a remote link to the spec path.

**Graceful degradation:** Each write protocol is independent. If one fails, continue with the others. Report failures at the end.

### Step 4: Confirm

Display a brief confirmation:

```
✅ Ticket {ticket_key} updated:
  - Summary posted as comment
  - Status transitioned to Done
  - Spec artifacts linked

{Or, if any step failed:}
⚠️ Ticket {ticket_key} partially updated:
  - ✅ Summary posted
  - ⚠️ Status transition failed (you may need to update manually)
  - ✅ Artifacts linked
```

## Outputs

**Handoff Data:**
```json
{
  "ticket_key": "PROJ-123",
  "summary_posted": true,
  "status_transitioned": true,
  "artifact_linked": true,
  "errors": []
}
```

## Error Handling

| Scenario | Behavior |
|----------|----------|
| No ticket_key in context | Return silently — not a ticket-driven feature |
| Adapter MCP not available | Write summary to local file as fallback. Non-blocking. |
| Post comment fails | Log error, continue with status transition. Non-blocking. |
| Status transition fails | Log error, suggest manual update. Non-blocking. |
| Link artifact fails | Log error, continue. Non-blocking. |
| All writes fail | Show warning with all errors. Write summary locally. Non-blocking. |
| Review not approved | Post summary but do NOT transition status. Note that changes were requested. |

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2026-02-20 | Initial release — S4-104 Phase 2: post summary, transition status, link artifacts with graceful degradation |
